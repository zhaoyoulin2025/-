(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["shops/collect"],{"361b":function(o,t,a){"use strict";a.r(t);var e=a("3ab6"),n=a("c23e");for(var i in n)["default"].indexOf(i)<0&&function(o){a.d(t,o,(function(){return n[o]}))}(i);a("cc7b");var s=a("f0c5"),r=Object(s["a"])(n["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],void 0);t["default"]=r.exports},"3ab6":function(o,t,a){"use strict";a.d(t,"b",(function(){return e})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var e=function(){var o=this.$createElement,t=(this._self._c,this.formData.shopImages.length);this.$mp.data=Object.assign({},{$root:{g0:t}})},n=[]},"722b":function(o,t,a){"use strict";(function(o,e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a("0e51");var n=a("e692"),i=a("1b89"),s={data:function(){return{formData:{address:"",name:"",residence:"",province:"",city:"",district:"",shopImages:[],videoUrl:"",rent:"",area:"",imgUrl:"",shopSize:"",menkuan:"",waibai:"",nianxian:"",dizneg:"",norent:"",dian:"",shui:"",yajin:"",zhuanrangfei:"",acondition:"",guanggao:"",allDesc:""},region:["","",""]}},methods:{regionChange:function(o){this.region=o.detail.value,this.formData.province=this.region[0],this.formData.city=this.region[1],this.formData.district=this.region[2],this.formData.residence=this.region.join(" ")},takePhoto:function(){var t=this;this.formData.shopImages.length>=3?o.showToast({title:"最多只能上传3张图片",icon:"none"}):o.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera","album"],success:function(o){var a=o.tempFilePaths[0],e=t.formData.shopImages.length;t.formData.shopImages.push(a),t.uploadImage(a,e)},fail:function(t){console.error("选择图片失败",t),o.showToast({title:"选择图片失败",icon:"none"})}})},uploadImage:function(t,a){console.log("上传图片：",t,"索引：",a);var n=this;o.showLoading({title:"上传中..."});try{var s="data:image/jpeg;base64,"+e.getFileSystemManager().readFileSync(t,"base64"),r={base64Str:s};i.request("common/uploadImageWater",r,"POST").then((function(t){o.hideLoading(),200===t.code?(n.formData.shopImages[a]=t.url,console.log("上传成功，图片URL:",t.url,"索引：",a),o.showToast({title:"上传成功",icon:"success"})):(n.formData.shopImages.splice(a,1),console.error("上传失败",t),o.showToast({icon:"none",title:t.msg||"上传失败，请稍后再试",duration:2e3}))})).catch((function(t){o.hideLoading(),n.formData.shopImages.splice(a,1),console.error("上传请求失败",t),o.showToast({icon:"none",title:"网络错误，请稍后再试",duration:2e3})}))}catch(c){o.hideLoading(),n.formData.shopImages.splice(a,1),console.error("上传过程发生错误",c),o.showToast({icon:"none",title:"上传失败，请稍后再试",duration:2e3})}},deleteImage:function(o){this.formData.shopImages.splice(o,1)},takeVideo:function(){var t=this;o.chooseVideo({sourceType:["camera","album"],maxDuration:60,camera:"back",compressed:!0,success:function(o){var a=o.tempFilePath;t.uploadVideo(a)},fail:function(t){console.error("选择视频失败",t),o.showToast({title:"选择视频失败",icon:"none"})}})},uploadVideo:function(t){console.log("上传视频：",t);var a=this;o.showLoading({title:"上传中..."}),o.uploadFile({url:n.baseUrl+"common/upload",filePath:t,name:"file",header:{Authorization:i.getToken()},success:function(t){o.hideLoading(),console.log("上传响应：",t);var e=JSON.parse(t.data);200===e.code?(a.formData.videoUrl=e.url,console.log("上传成功，视频URL:",e.url),o.showToast({title:"上传成功",icon:"success"})):(console.error("上传失败",t),o.showToast({icon:"none",title:t.msg||"上传失败，请稍后再试",duration:2e3}))},fail:function(t){o.hideLoading(),console.error("上传请求失败",t),o.showToast({icon:"none",title:"网络错误，请稍后再试",duration:2e3})}})},deleteVideo:function(){this.formData.videoUrl="",o.showToast({title:"视频已删除",icon:"success"})},submitForm:function(){this.formData.name?this.formData.province&&this.formData.city&&this.formData.district?this.formData.address?this.formData.shopSize?this.formData.menkuan?this.formData.waibai?this.formData.nianxian?this.formData.rent?this.formData.dizneg?this.formData.norent?this.formData.dian?this.formData.shui?this.formData.yajin?this.formData.zhuanrangfei?this.formData.acondition?this.formData.guanggao?this.formData.shopImages.length<=0?o.showToast({title:"请上传店铺照片",icon:"none"}):this.formData.videoUrl?(this.formData.area=this.formData.province+","+this.formData.city+","+this.formData.district,this.formData.imgUrl=this.formData.shopImages.join(","),console.log("表单数据：",this.formData),o.showLoading({title:"提交中",mask:!0}),i.request("wx/api/insertShop",this.formData,"POST").then((function(t){o.hideLoading(),200===t.code?o.navigateBack({delta:1}):o.showToast({icon:"none",title:t.msg,duration:2e3})}))):o.showToast({title:"请上传店铺视频",icon:"none"}):o.showToast({title:"请输入店铺广告位",icon:"none"}):o.showToast({title:"请输入店铺工程条件",icon:"none"}):o.showToast({title:"请输入店铺转让费",icon:"none"}):o.showToast({title:"请输入店铺押金",icon:"none"}):o.showToast({title:"请输入店铺水费",icon:"none"}):o.showToast({title:"请输入店铺电费",icon:"none"}):o.showToast({title:"请输入店铺装修免租期",icon:"none"}):o.showToast({title:"请输入店铺租金年递增",icon:"none"}):o.showToast({title:"请输入店铺租金",icon:"none"}):o.showToast({title:"请输入店铺年限",icon:"none"}):o.showToast({title:"请输入店铺外摆",icon:"none"}):o.showToast({title:"请输入店铺门宽",icon:"none"}):o.showToast({title:"请输入店铺面积",icon:"none"}):o.showToast({title:"请输入店铺详细地址",icon:"none"}):o.showToast({title:"请选择店铺所在地区",icon:"none"}):o.showToast({title:"请输入店铺名称",icon:"none"})}}};t.default=s}).call(this,a("543d")["default"],a("bc2e")["default"])},ba35:function(o,t,a){"use strict";(function(o,t){var e=a("4ea4");a("3cdf");e(a("66fd"));var n=e(a("361b"));o.__webpack_require_UNI_MP_PLUGIN__=a,t(n.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},c23e:function(o,t,a){"use strict";a.r(t);var e=a("722b"),n=a.n(e);for(var i in e)["default"].indexOf(i)<0&&function(o){a.d(t,o,(function(){return e[o]}))}(i);t["default"]=n.a},c60a:function(o,t,a){},cc7b:function(o,t,a){"use strict";var e=a("c60a"),n=a.n(e);n.a}},[["ba35","common/runtime","common/vendor"]]]);