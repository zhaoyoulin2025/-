(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"0637":function(e,t,o){"use strict";(function(e,t,n){var c=o("4ea4"),r=c(o("9523"));o("3cdf");var a=c(o("30d4")),s=c(o("ac50")),i=c(o("66fd")),u=c(o("ab06"));function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}e.__webpack_require_UNI_MP_PLUGIN__=o,i.default.mixin(s.default),i.default.use(u.default);i.default.component("cu-custom",(function(){o.e("colorui/components/cu-custom").then(function(){return resolve(o("3922"))}.bind(null,o)).catch(o.oe)})),t.getSystemInfo({success:function(t){i.default.prototype.StatusBar=t.statusBarHeight;var o=e.getMenuButtonBoundingClientRect();i.default.prototype.Custom=o,i.default.prototype.CustomBar=o.bottom+o.top-t.statusBarHeight}});i.default.prototype.myimgurl=function(){return"https://ga.rasmall.cn/prod-api"};i.default.component("custom-tab-bar",(function(){o.e("components/custom-tab-bar").then(function(){return resolve(o("ab8c"))}.bind(null,o)).catch(o.oe)})),i.default.config.productionTip=!1,a.default.mpType="app";var f=new i.default(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},a.default));i.default.prototype.jump=function(e){t.navigateTo({url:e})},i.default.prototype.mes=function(e){t.showToast({title:e,icon:"none"})},i.default.prototype.Godetails=function(e,o){console.log(JSON.stringify(e)),t.navigateTo({url:o+"?params="+JSON.stringify(e)})},i.default.prototype.ZH=function(e){return JSON.parse(e)},n(f).$mount()}).call(this,o("bc2e")["default"],o("543d")["default"],o("543d")["createApp"])},"30d4":function(e,t,o){"use strict";o.r(t);var n=o("7d5a");for(var c in n)["default"].indexOf(c)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(c);o("312d");var r=o("f0c5"),a=Object(r["a"])(n["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);t["default"]=a.exports},"312d":function(e,t,o){"use strict";var n=o("f695"),c=o.n(n);c.a},4657:function(e,t,o){"use strict";(function(e){var n=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=n(o("2eee")),r=n(o("c973")),a=o("0e51"),s=o("e692"),i=o("1b89"),u={onLaunch:function(){var t=(0,r.default)(c.default.mark((function t(o){var n,r,s,i,u,l;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.onError((function(t){console.error("全局错误：",t),e.showModal({title:"错误提示",content:"应用出现异常，请重试",showCancel:!1})})),e.canIUse("getUpdateManager")){t.next=3;break}return t.abrupt("return");case 3:n=e.getUpdateManager(),n.onCheckForUpdate((function(t){console.log("是否有新版本："+t.hasUpdate),t.hasUpdate&&(n.onUpdateReady((function(){e.showModal({title:"更新提示",content:"新版本已经准备好，单击确定重启小程序",showCancel:!1,success:function(e){e.confirm&&n.applyUpdate()}})})),n.onUpdateFailed((function(){e.showModal({title:"提示",content:"检查到有新版本，但下载失败，请稍后尝试",showCancel:!1})})))})),r=["/pages/login/login","/pages/login/serverLogin"],e.addInterceptor("navigateTo",{invoke:function(t){if(!r.includes(t.url.split("?")[0])){var o=(0,a.getToken)();return!!o||(e.redirectTo({url:"/pages/login/login"}),!1)}return!0}}),e.addInterceptor("redirectTo",{invoke:function(t){if(!r.includes(t.url.split("?")[0])){var o=(0,a.getToken)();return!!o||(e.redirectTo({url:"/pages/login/login"}),!1)}return!0}}),s=(0,a.getToken)(),s&&(i=(0,a.getUserType)(),console.log("userType",i),u=getCurrentPages(),l=u.length>0?u[u.length-1].route:"","1"===i&&"pages/index/serverIndex"!==l?(console.log("跳转到员工端首页"),e.reLaunch({url:"/pages/index/serverIndex"})):"1"!==i&&"pages/index/index"!==l&&(console.log("跳转到普通用户首页"),e.reLaunch({url:"/pages/index/index"})));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onShow:function(){this.socketTask&&1===this.socketTask.readyState||this.initWebSocket()},methods:{initWebSocket:function(){var t=this,o=(0,a.getUserInfo)();if(o){var n=s.baseUrl.replace("http://","ws://").replace("https://","wss://")+"wsServer";this.socketTask=e.connectSocket({url:n+"/"+o.userId,success:function(){console.log("WebSocket连接成功")},fail:function(e){console.error("WebSocket连接失败",e)}}),this.socketTask.onOpen((function(){console.log("WebSocket连接已打开"),t.socketTask.onMessage((function(e){if(console.log("收到WebSocket消息:",e.data),"连接成功"!=e.data)try{var o=JSON.parse(e.data),n=(0,a.getUserInfo)(),c=n?n.userId:null;o.userId&&o.userId===c&&t.showMessagePopup(o)}catch(r){console.error("解析WebSocket消息失败",r)}})),t.socketTask.onClose((function(){console.log("WebSocket连接已关闭"),setTimeout((function(){t.initWebSocket()}),3e3)})),t.socketTask.onError((function(e){console.error("WebSocket错误",e)}))}))}},showMessagePopup:function(t){var o=this;e.showModal({title:t.title||"新消息",content:t.content||"",showCancel:!1!==t.showCancel,cancelText:t.cancelText||"关闭",confirmText:t.confirmText||"查看详情",success:function(n){n.confirm&&(i.request("wx/api/readMessage",{id:t.id},"POST","application/json",!1,!0).then((function(t){e.hideLoading(),200===t.code?o.noticelist=t.data:e.showToast({title:t.msg||"获取失败",icon:"none"})})).catch((function(t){e.hideLoading(),e.showToast({title:"网络异常，请稍后再试",icon:"none"})})),e.navigateTo({url:"/pages/me/mynotice/mynotice"})),t.messageId&&o.markMessageAsRead(t.messageId)}})},markMessageAsRead:function(e){},closeWebSocket:function(){this.socketTask&&this.socketTask.close({success:function(){console.log("WebSocket连接已关闭")},fail:function(e){console.error("关闭WebSocket连接失败",e)}})}},onHide:function(){console.log("App Hide")},onUnload:function(){this.closeWebSocket()},globalData:{userinfo:null,token:"",socketTask:null}};t.default=u}).call(this,o("543d")["default"])},"7d5a":function(e,t,o){"use strict";o.r(t);var n=o("4657"),c=o.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=c.a},f695:function(e,t,o){}},[["0637","common/runtime","common/vendor"]]]);